<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biashara Connect | Register</title>

    <!-- Favicons -->
    <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/assets/img/apple-touch-icon.png">

    <!-- Vendor CSS -->
    <link href="/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Raleway:wght@700;800;900&display=swap"
        rel="stylesheet">

    <!-- Main CSS -->
    <link href="/assets/css/main.css" rel="stylesheet">
    <link href="/assets/css/register.css" rel="stylesheet">

</head>

<body>
    <section class="header section">
        <header id="header" class="header">
            <div class="container">

                <!-- TOP BAR: Logo + Mobile Toggle + Account -->
                <div class="d-flex align-items-center justify-content-between py-2">

                    <!-- Logo Section -->
                    <div class="logo-section d-flex align-items-center">
                        <button class="mobile-menu-btn d-lg-none me-3" aria-label="Toggle Navigation">
                            <i class="fas fa-bars"></i>
                        </button>


                        <a href="/index.html" class="logo d-flex align-items-center text-decoration-none">
                            <i class="fas fa-handshake logo-icon me-2"></i>
                            <div>
                                <div class="logo-text fw-bold">BiasharaConnect</div>
                                <small class="logo-tagline text-muted d-none d-sm-block">
                                    Kenya's Marketplace
                                </small>
                            </div>
                        </a>
                    </div>

                    <!-- Account Dropdown (Desktop) -->
                    <div class="d-flex align-items-center justify-content-between py-2">
                        <div class="dropdown">
                            <a href="#" class="btn btn-outline-primary-green dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-2"></i> My Account
                            </a>

                            <div class="dropdown-menu dropdown-menu-end">
                                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#SellerModal">
                                    <i class="fas fa-user me-2"></i> Seller Profile
                                </a>

                                <a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#BuyerModal">
                                    <i class="fas fa-user me-2"></i> Buyer Profile
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item active" href="register.html">
                                    <i class="fas fa-user-plus me-2"></i> Register
                                </a>

                                <a class="dropdown-item" href="login.html">
                                    <i class="fas fa-sign-in-alt me-2"></i> Login
                                </a>

                                <a class="dropdown-item text-danger" href="#">
                                    <i class="fas fa-sign-out-alt me-2"></i> Logout
                                </a>
                            </div>
                        </div>
                    </div>

                </div>


                <!-- NAVIGATION BAR -->
                <nav class="main-nav border-top pt-2" aria-label="Main Navigation">
                    <ul class="nav justify-content-center" id="mainMenu">

                        <li class="nav-item">
                            <a href="/index.html" class="nav-link">
                                <i class="fas fa-store me-2"></i> Marketplace
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/sell.html" class="nav-link">
                                <i class="fas fa-hand-holding-dollar me-2"></i> Sell & Earn
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/favorites.html" class="nav-link">
                                <i class="fas fa-bookmark me-2"></i> Favorites
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/my-listings.html" class="nav-link">
                                <i class="fas fa-list-alt me-2"></i> My Listings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="/messages.html" class="nav-link">
                                <span>
                                    <i class="fas fa-comment-dots me-2"></i> Messages
                                </span>
                                <span class="badge bg-danger">5</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="/support.html" class="nav-link">
                                <i class="fas fa-headset me-2"></i> Contact Us
                            </a>
                        </li>


                    </ul>
                </nav>

            </div>
        </header>

        <div id="modals-placeholder"></div>
    </section>

    <main class="page-content">
        <div class="auth-page">

            <!-- Header -->
            <div class="auth-header">
                <div class="icon-circle">
                    <i class="fas fa-user-plus fa-lg text-success"></i>
                </div>
                <div>
                    <h2>Create Your Account</h2>
                    <p>Join thousands of users in our community</p>
                </div>
            </div>

            <!-- Tabs -->
            <ul class="nav nav-tabs nav-fill" id="registerTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="buyer-tab" data-bs-toggle="tab" data-bs-target="#buyer"
                        type="button" role="tab">
                        <i class="fas fa-shopping-cart"></i> Buyer
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="seller-tab" data-bs-toggle="tab" data-bs-target="#seller" type="button"
                        role="tab">
                        <i class="fas fa-store"></i> Seller
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content mt-4" id="registerTabContent">

                <!-- Buyer Form -->
                <div class="tab-pane fade show active" id="buyer" role="tabpanel">
                    <form id="buyerForm" class="needs-validation" novalidate>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-user text-success me-1"></i>First
                                    Name</label>
                                <input type="text" name="first_name" class="form-control"
                                    placeholder="Enter your first name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-user text-success me-1"></i>Last Name</label>
                                <input type="text" name="last_name" class="form-control"
                                    placeholder="Enter your last name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-envelope text-success me-1"></i>Email
                                    Address</label>
                                <input type="email" name="email" class="form-control" placeholder="you@example.com"
                                    required>
                                <div class="form-text">We'll never share your email with anyone else.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-phone text-success me-1"></i>Phone
                                    Number</label>
                                <input type="tel" name="phone" class="form-control" placeholder="+254 7XX XXX XXX"
                                    required>
                            </div>
                            <div class="col-6">
                                <label class="form-label"><i
                                        class="fas fa-map-marker-alt text-success me-1"></i>Location</label>
                                <select name="location" class="form-select" required>
                                    <option value="" disabled selected>Select your city</option>
                                    <option>Nairobi</option>
                                    <option>Mombasa</option>
                                    <option>Kisumu</option>
                                    <option>Nakuru</option>
                                    <option>Eldoret</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-lock text-success me-1"></i>Password</label>
                                <input type="password" name="password" class="form-control"
                                    placeholder="Create a strong password" required>
                                <div class="password-requirements">Must be at least 8 characters with letters & numbers
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-lock text-success me-1"></i>Confirm
                                    Password</label>
                                <input type="password" name="confirm_password" class="form-control"
                                    placeholder="Enter your password" required>
                            </div>
                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="buyerTerms" required>
                                    <label class="form-check-label" for="buyerTerms">
                                        I agree to the <a href="#">Terms & Conditions</a> and <a href="#">Privacy
                                            Policy</a>
                                    </label>
                                </div>
                            </div>
                            <div class="col-12 mt-2">
                                <button type="submit" class="btn btn-submit"><i
                                        class="fas fa-user-check me-2"></i>Create
                                    Buyer Account</button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Seller Form -->
                <div class="tab-pane fade" id="seller" role="tabpanel">
                    <form id="sellerForm" class="needs-validation" novalidate>
                        <div class="row g-2">

                            <!-- Profile Upload -->
                            <div class="col-12">
                                <h6 class="fw-bold text-success mb-3"><i class="fas fa-user-circle me-2"></i>Profile
                                    Picture
                                    (Optional)</h6>
                                <div class="row align-items-center">
                                    <div class="col-md-3 text-center mb-3 mb-md-0">
                                        <img id="sellerProfilePreview"
                                            src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
                                            alt="Profile preview" class="rounded-circle profile-preview"
                                            style="width:100px; height:100px;">
                                    </div>
                                    <div class="col-md-9">
                                        <label for="sellerProfile" class="form-label">Upload Profile Picture</label>
                                        <input type="file" class="form-control" id="sellerProfile" name="profile_image"
                                            accept="image/*" onchange="previewSellerProfile(event)">
                                        <div class="form-text">JPG, PNG, or GIF. Max 2MB.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Personal Info -->
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-user text-success me-1"></i>First
                                    Name</label>
                                <input type="text" name="first_name" class="form-control"
                                    placeholder="Enter your first name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-user text-success me-1"></i>Last Name</label>
                                <input type="text" name="last_name" class="form-control"
                                    placeholder="Enter your last name" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-envelope text-success me-1"></i>Email
                                    Address</label>
                                <input type="email" name="email" class="form-control" placeholder="business@example.com"
                                    required>
                                <div class="form-text">Use your business email if available.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-phone text-success me-1"></i>Phone
                                    Number</label>
                                <input type="tel" name="phone" class="form-control" placeholder="+254 7XX XXX XXX"
                                    required>
                            </div>

                            <!-- Password -->
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-lock text-success me-1"></i>Password</label>
                                <input type="password" name="password" class="form-control"
                                    placeholder="Create a strong password" required>
                                <div class="password-requirements">Must be at least 8 characters with letters & numbers
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-lock text-success me-1"></i>Confirm
                                    Password</label>
                                <input type="password" name="confirm_password" class="form-control"
                                    placeholder="Enter your password" required>
                            </div>

                            <!-- Business Info -->
                            <div class="col-12 seller-field">
                                <h6 class="fw-bold text-success mb-3"><i class="fas fa-briefcase me-2"></i>Business
                                    Information</h6>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Business Name</label>
                                        <input type="text" name="business_name" class="form-control"
                                            placeholder="Enter your business/store name" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Business Location</label>
                                        <select name="business_location" class="form-select" required>
                                            <option value="" disabled selected>Select your business city</option>
                                            <option>Nairobi</option>
                                            <option>Mombasa</option>
                                            <option>Kisumu</option>
                                            <option>Nakuru</option>
                                            <option>Eldoret</option>
                                            <option>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Business Type</label>
                                        <select name="business_type" class="form-select" required>
                                            <option value="" disabled selected>Select business type</option>
                                            <option value="individual">Individual/Sole Proprietor</option>
                                            <option value="company">Registered Company</option>
                                            <option value="cooperative">Cooperative</option>
                                            <option value="partnership">Partnership</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Business Category</label>
                                        <select name="business_category" class="form-select" required>
                                            <option value="" disabled selected>Select category</option>
                                            <option value="electronics">Electronics & Gadgets</option>
                                            <option value="fashion">Fashion & Apparel</option>
                                            <option value="home">Home & Living</option>
                                            <option value="food">Food & Beverages</option>
                                            <option value="automotive">Automotive</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Bio / Description</label>
                                    <textarea class="form-control" name="bio" rows="3"
                                        placeholder="Tell us about your business..."></textarea>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="sellerTerms" required>
                                    <label class="form-check-label" for="sellerTerms">
                                        I agree to the <a href="#">Seller Terms & Conditions</a>, <a href="#">Privacy
                                            Policy</a>
                                    </label>
                                </div>
                            </div>

                            <div class="col-12 mt-2">
                                <button type="submit" class="btn btn-submit"><i class="fas fa-store me-2"></i>Create
                                    Seller
                                    Account</button>
                            </div>

                        </div>
                    </form>
                </div>

            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/main.js" defer></script>
    <script>

        // Load header & footer and modals
        function loadHTML(elementId, filePath) {
            return fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                });
        }

        window.onload = function () {
            // Load all components
            Promise.all([
                loadHTML('footer-placeholder', '/includes/footer.html')
            ]);
        };
    </script>

    <script>
        const API_BASE = "https://biashara-connect-backend.onrender.com";

        // Utility to show alerts
        function showAlert(alertBox, message) {
            alertBox.textContent = message;
            alertBox.style.display = 'block';
        }

        // Buyer Form Submission
        document.getElementById('buyerForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const alertBox = document.getElementById('buyerAlert');
            alertBox.style.display = 'none';
            alertBox.textContent = '';

            const formData = Object.fromEntries(new FormData(this).entries());

            // Password confirmation check
            if (formData.password !== formData.confirm_password) {
                showAlert(alertBox, "Passwords do not match!");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/api/auth/register/buyer/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await res.json();

                if (!res.ok) {
                    showAlert(alertBox, data.error || JSON.stringify(data));
                } else {
                    alert('Buyer registered successfully! Please login.');
                    window.location.href = 'login.html';
                }
            } catch (err) {
                showAlert(alertBox, 'Something went wrong. Please try again.');
                console.error(err);
            }
        });

        // Seller Form Submission
        document.getElementById('sellerForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            const alertBox = document.getElementById('sellerAlert');
            alertBox.style.display = 'none';
            alertBox.textContent = '';

            const formDataObj = new FormData(this);

            // Password confirmation check
            if (formDataObj.get('password') !== formDataObj.get('confirm_password')) {
                showAlert(alertBox, "Passwords do not match!");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/api/auth/register/seller/`, {
                    method: 'POST',
                    body: formDataObj
                });

                const data = await res.json();

                if (!res.ok) {
                    showAlert(alertBox, data.error || JSON.stringify(data));
                } else {
                    alert('Seller registered successfully! Please login.');
                    window.location.href = 'login.html';
                }
            } catch (err) {
                showAlert(alertBox, 'Something went wrong. Please try again.');
                console.error(err);
            }
        });
    </script>
    
</body>

</html>