<section id="header" class="header section">
    <header class="main-header">
        <div class="container py-3">

            <div class="row align-items-center justify-content-between g-3">

                <div class="col-lg-3 col-md-4 col-10 col-sm-8 logo-section d-flex align-items-center">
                    <button class="mobile-menu-btn me-2 me-sm-3 d-lg-none" aria-label="Toggle Navigation">
                        <i class="fas fa-bars"></i>
                    </button>

                    <a href="/index.html" class="logo d-flex align-items-center text-nowrap">
                        <i class="fas fa-handshake logo-icon"></i>
                        <div class="logo-text-wrapper">
                            <div class="logo-text">BiasharaConnect</div>
                            <div class="logo-tagline d-none d-sm-block">Kenya's Marketplace</div>
                        </div>
                    </a>
                </div>

                <div class="col-lg-5 col-md-8 col-12 search-container d-flex justify-content-center">
                    <div class="search-box d-flex w-100">
                        <input type="text" class="search-input" placeholder="Search products, services, or sellers...">
                        <button class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <nav aria-label="Main Navigation">
                        <ul class="nav-menu d-flex justify-content-center" id="mainMenu">

                            <li class="nav-item">
                                <a href="/index.html" class="nav-link">
                                    <i class="fas fa-store me-2"></i> Marketplace
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/sell.html" class="nav-link">
                                    <i class="fas fa-hand-holding-dollar me-2"></i> Sell & Earn
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/favorites.html" class="nav-link">
                                    <i class="fas fa-bookmark me-2"></i> Favorites
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/my-listings.html" class="nav-link">
                                    <i class="fas fa-list-alt me-2"></i> My Listings
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/support.html" class="nav-link active">
                                    <i class="fas fa-envelope me-2"></i> Contact Us
                                </a>
                            </li>

                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-circle me-2"></i> My Account
                                </a>

                                <div class="dropdown-menu">
                                    <!-- Profile Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#SellerModal">
                                        <i class="fas fa-user me-2"></i> Seller Profile
                                    </a>

                                    <!-- Profile Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#BuyerModal">
                                        <i class="fas fa-user me-2"></i> Buyer Profile
                                    </a>

                                    <a class="dropdown-item d-flex justify-content-between align-items-center"
                                        href="/messages.html">
                                        <span><i class="fas fa-envelope me-2"></i> Messages</span>
                                        <span class="badge bg-danger">5</span>
                                    </a>

                                    <div class="dropdown-divider"></div>

                                    <!-- Register Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#registerModal">
                                        <i class="fas fa-user-plus me-2"></i> Register
                                    </a>

                                    <!-- Login Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#loginModal">
                                        <i class="fas fa-sign-in-alt me-2"></i> Login
                                    </a>

                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                                    </a>
                                </div>
                            </li>

                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div id="modals-placeholder"></div>

</section>










<!-- My Listings Hero Section -->
<section id="my-listings-hero" class="my-listings-hero py-4">
    <div class="container my-listings-hero-content">
        <h1><i class="fas fa-list-alt me-2"></i>My Listings</h1>
        <p>Manage your products and services, track performance, and connect with buyers</p>

        <div class="my-listings-stats">
            <div class="stat-item">
                <span class="stat-number" id="totalListings">0</span>
                <span class="stat-label">Total Listings</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="activeListings">0</span>
                <span class="stat-label">Active</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="soldListings">0</span>
                <span class="stat-label">Sold</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="totalViews">0</span>
                <span class="stat-label">Total Views</span>
            </div>
        </div>
    </div>
</section>





<!-- Registration Modal -->
<div class="modal fade auth-modal" id="registerModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <!-- Header -->
            <div class="modal-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="icon-circle bg-success bg-opacity-10 p-2 rounded-3">
                        <i class="fas fa-user-plus fa-lg text-success"></i>
                    </div>
                    <div>
                        <h5 class="modal-title mb-1">Create Your Account</h5>
                        <p class="text-muted small mb-0">Join thousands of users in our community</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">

                <!-- Tabs Navigation -->
                <div class="d-flex justify-content-center">
                    <ul class="nav nav-tabs nav-fill" id="registerTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="buyer-tab" data-bs-toggle="tab" data-bs-target="#buyer"
                                type="button" role="tab">
                                <i class="fas fa-shopping-cart"></i>
                                <span>Register as Buyer</span>
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="seller-tab" data-bs-toggle="tab" data-bs-target="#seller"
                                type="button" role="tab">
                                <i class="fas fa-store"></i>
                                <span>Register as Seller</span>
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Tab Content -->
                <div class="tab-content mt-4" id="registerTabContent">

                    <!-- Buyer Form -->
                    <div class="tab-pane fade show active" id="buyer" role="tabpanel">
                        <form id="buyerForm" class="needs-validation" novalidate>
                            <div class="row g-2">

                                <!-- Personal Information -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-user text-success me-1"></i>First Name
                                    </label>
                                    <input type="text" name="first_name" class="form-control"
                                        placeholder="Enter your first name" required>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-user text-success me-1"></i>Last Name
                                    </label>
                                    <input type="text" name="last_name" class="form-control"
                                        placeholder="Enter your last name" required>
                                </div>

                                <!-- Contact Information -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-envelope text-success me-1"></i>Email Address
                                    </label>
                                    <input type="email" name="email" class="form-control" placeholder="you@example.com"
                                        required>
                                    <div class="form-text">We'll never share your email with anyone else.</div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-phone text-success me-1"></i>Phone Number
                                    </label>
                                    <input type="tel" name="phone" class="form-control" placeholder="+254 7XX XXX XXX"
                                        required>
                                </div>

                                <!-- Location -->
                                <div class="col-6">
                                    <label class="form-label">
                                        <i class="fas fa-map-marker-alt text-success me-1"></i>Location
                                    </label>
                                    <select name="location" class="form-select" required>
                                        <option value="" disabled selected>Select your city</option>
                                        <option value="Nairobi">Nairobi</option>
                                        <option value="Mombasa">Mombasa</option>
                                        <option value="Kisumu">Kisumu</option>
                                        <option value="Nakuru">Nakuru</option>
                                        <option value="Eldoret">Eldoret</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>

                                <!-- Password -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-lock text-success me-1"></i>Password
                                    </label>
                                    <input type="password" name="password" class="form-control"
                                        placeholder="Create a strong password" required>
                                    <div class="password-requirements">
                                        Must be at least 8 characters with letters & numbers
                                    </div>
                                </div>

                                <!--Confirm Password -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-lock text-success me-1"></i>Confirm Password
                                    </label>
                                    <input type="password" name="confirm_password" class="form-control"
                                        placeholder="Enter your password" required>
                                </div>

                                <!-- Terms & Conditions -->
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="buyerTerms" required>
                                        <label class="form-check-label" for="buyerTerms">
                                            I agree to the <a href="#" class="fw-bold">Terms & Conditions</a> and
                                            <a href="#" class="fw-bold">Privacy Policy</a>
                                        </label>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="col-12 mt-2">
                                    <button type="submit" class="btn btn-submit">
                                        <i class="fas fa-user-check me-2"></i>
                                        Create Buyer Account
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <!-- Seller Form -->
                    <div class="tab-pane fade" id="seller" role="tabpanel">
                        <form id="sellerForm" class="needs-validation" novalidate>
                            <div class="row g-2">

                                <!-- Profile Picture Upload (Optional) -->
                                <div class="col-12">
                                    <h6 class="fw-bold text-success mb-3">
                                        <i class="fas fa-user-circle me-2"></i>Profile Picture (Optional)
                                    </h6>
                                    <div class="row align-items-center">
                                        <div class="col-md-3 text-center mb-3 mb-md-0">
                                            <img id="sellerProfilePreview"
                                                src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
                                                alt="Profile preview" class="rounded-circle"
                                                style="width: 100px; height: 100px; object-fit: cover; border: 3px solid #198754;">
                                        </div>
                                        <div class="col-md-9">
                                            <label for="sellerProfile" class="form-label">Upload Profile Picture</label>
                                            <input type="file" class="form-control" id="sellerProfile"
                                                name="profile_image" accept="image/*"
                                                onchange="previewSellerProfile(event)">
                                            <div class="form-text">JPG, PNG, or GIF. Max 2MB.</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Personal Information -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-user text-success me-1"></i>First Name
                                    </label>
                                    <input type="text" name="first_name" class="form-control"
                                        placeholder="Enter your first name" required>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-user text-success me-1"></i>Last Name
                                    </label>
                                    <input type="text" name="last_name" class="form-control"
                                        placeholder="Enter your last name" required>
                                </div>

                                <!-- Contact Information -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-envelope text-success me-1"></i>Email Address
                                    </label>
                                    <input type="email" name="email" class="form-control"
                                        placeholder="business@example.com" required>
                                    <div class="form-text">Use your business email if available.</div>
                                </div>

                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-phone text-success me-1"></i>Phone Number
                                    </label>
                                    <input type="tel" name="phone" class="form-control" placeholder="+254 7XX XXX XXX"
                                        required>
                                </div>


                                <!-- Password -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-lock text-success me-1"></i>Password
                                    </label>
                                    <input type="password" name="password" class="form-control"
                                        placeholder="Create a strong password" required>
                                    <div class="password-requirements">
                                        Must be at least 8 characters with letters & numbers
                                    </div>
                                </div>
                                <!--Confirm Password -->
                                <div class="col-md-6">
                                    <label class="form-label">
                                        <i class="fas fa-lock text-success me-1"></i>Confirm Password
                                    </label>
                                    <input type="password" name="confirm_password" class="form-control"
                                        placeholder="Enter your password" required>
                                </div>

                                <!-- Business Information -->
                                <div class="col-12 seller-field">
                                    <h6 class="fw-bold text-success mb-3">
                                        <i class="fas fa-briefcase me-2"></i>Business Information
                                    </h6>

                                    <div class="row">
                                        <!--Business Name -->
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Business Name</label>
                                            <input type="text" class="form-control" name="business_name"
                                                placeholder="Enter your business/store name" required>
                                        </div>

                                        <!--Business Location -->
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Business Location</label>
                                            <select class="form-select" name="business_location" required>
                                                <option value="" disabled selected>Select your business city</option>
                                                <option value="Nairobi">Nairobi</option>
                                                <option value="Mombasa">Mombasa</option>
                                                <option value="Kisumu">Kisumu</option>
                                                <option value="Nakuru">Nakuru</option>
                                                <option value="Eldoret">Eldoret</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Business Type</label>
                                            <select class="form-select" name="business_type" required>
                                                <option value="" disabled selected>Select business type</option>
                                                <option value="individual">Individual/Sole Proprietor</option>
                                                <option value="company">Registered Company</option>
                                                <option value="cooperative">Cooperative</option>
                                                <option value="partnership">Partnership</option>
                                            </select>
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">Business Category</label>
                                            <select class="form-select" name="business_category" required>
                                                <option value="" disabled selected>Select category</option>
                                                <option value="electronics">Electronics & Gadgets</option>
                                                <option value="fashion">Fashion & Apparel</option>
                                                <option value="home">Home & Living</option>
                                                <option value="food">Food & Beverages</option>
                                                <option value="automotive">Automotive</option>
                                                <option value="other">Other</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <label class="form-label">Bio / Description</label>
                                    <textarea class="form-control" name="bio" rows="3"
                                        placeholder="Tell us about your business...">Experienced seller with 5+ years in electronics. Specializing in smartphones and accessories.</textarea>
                                </div>

                                <!-- Seller Terms -->
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="sellerTerms" required>
                                        <label class="form-check-label" for="sellerTerms">
                                            I agree to the <a href="#" class="fw-bold">Seller Terms & Conditions</a>,
                                            <a href="#" class="fw-bold">Privacy Policy</a>, and confirm I have the right
                                            to sell these products
                                        </label>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="col-12 mt-2">
                                    <button type="submit" class="btn btn-submit">
                                        <i class="fas fa-store me-2"></i>
                                        Create Seller Account
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Footer Link -->
                <div class="auth-footer">
                    Already have an account?
                    <a href="#" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#loginModal">
                        Sign in here
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>






<script>
    document.addEventListener("DOMContentLoaded", () => {
        const API_BASE = "https://biashara-connect-backend.onrender.com";

        // Helper function for displaying errors
        function showError(form, message) {
            let errorDiv = form.querySelector(".error-msg");
            if (!errorDiv) {
                errorDiv = document.createElement("div");
                errorDiv.className = "error-msg text-danger mb-3";
                form.prepend(errorDiv);
            }
            errorDiv.innerText = message;
            errorDiv.style.display = "block";
        }

        // ===== Buyer Registration =====
        const buyerForm = document.getElementById("buyerForm");
        if (buyerForm) {
            buyerForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                showError(buyerForm, "");

                const formData = {
                    first_name: buyerForm.querySelector("input[name='first_name']").value,
                    last_name: buyerForm.querySelector("input[name='last_name']").value,
                    email: buyerForm.querySelector("input[name='email']").value,
                    phone: buyerForm.querySelector("input[name='phone']").value,
                    password: buyerForm.querySelector("input[name='password']").value,
                    location: buyerForm.querySelector("select[name='location']").value,
                };

                try {
                    const res = await fetch(`${API_BASE}/api/auth/register/buyer/`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData),
                    });

                    const text = await res.text();
                    console.log("Buyer raw response:", text);

                    let data;
                    try { data = JSON.parse(text); } catch { data = { error: text }; }

                    if (res.ok) {
                        alert(data.message || "Buyer registered successfully!");
                        buyerForm.reset();
                    } else {
                        showError(buyerForm, data.error || JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    showError(buyerForm, "Network error. See console for details.");
                }
            });
        } else {
            console.error("buyerForm not found in DOM!");
        }

        // ===== Seller Registration =====
        const sellerForm = document.getElementById("sellerForm");
        if (sellerForm) {
            sellerForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                showError(sellerForm, "");

                const formData = new FormData();
                const fields = ["first_name", "last_name", "email", "phone", "password"];
                fields.forEach(f => {
                    const input = sellerForm.querySelector(`[name='${f}']`);
                    if (input) formData.append(f, input.value);
                });

                const locationSelect = sellerForm.querySelector("select[name='location']");
                if (locationSelect) formData.append("location", locationSelect.value);

                // Profile picture
                const profileInput = document.getElementById("sellerProfile");
                if (profileInput && profileInput.files.length > 0) {
                    formData.append("profile_picture", profileInput.files[0]);
                }

                try {
                    const res = await fetch(`${API_BASE}/api/auth/register/seller/`, {
                        method: "POST",
                        body: formData,
                    });

                    const text = await res.text();
                    console.log("Seller raw response:", text);

                    let data;
                    try { data = JSON.parse(text); } catch { data = { error: text }; }

                    if (res.ok) {
                        alert(data.message || "Seller registered successfully!");
                        sellerForm.reset();
                        if (profileInput) profileInput.value = "";
                    } else {
                        showError(sellerForm, data.error || JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    showError(sellerForm, "Network error. See console for details.");
                }
            });
        } else {
            console.error("sellerForm not found in DOM!");
        }
    });
</script>




<!-- JavaScript for Profile Picture Upload -->
<script>
    function previewSellerProfile(event) {
        const input = event.target;
        const preview = document.getElementById('sellerProfilePreview');

        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size should be less than 2MB');
                clearSellerProfile();
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, or WEBP)');
                clearSellerProfile();
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.add('border-success');
                preview.classList.remove('border-success-subtle');
            }
            reader.readAsDataURL(file);
        }
    }

    function clearSellerProfile() {
        const input = document.getElementById('sellerProfile');
        const preview = document.getElementById('sellerProfilePreview');

        input.value = '';
        preview.src = 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
        preview.classList.remove('border-success');
        preview.classList.add('border-success-subtle');
    }

    // Add click event to preview image to trigger file input
    document.addEventListener('DOMContentLoaded', function () {
        const preview = document.getElementById('sellerProfilePreview');
        if (preview) {
            preview.addEventListener('click', function () {
                document.getElementById('sellerProfile').click();
            });
        }

        // Form submission handler
        const sellerForm = document.getElementById('sellerForm');
        if (sellerForm) {
            sellerForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Here you would handle the form submission
                // The profile picture is optional, so no validation needed
                const formData = new FormData(this);
                const profileInput = document.getElementById('sellerProfile');

                if (profileInput.files.length > 0) {
                    formData.append('profile_picture', profileInput.files[0]);
                }

                // Add your AJAX submission logic here
                console.log('Seller form submitted with profile picture:', profileInput.files.length > 0);

                // For demonstration, just show an alert
                alert('Seller registration submitted successfully!');
            });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const API_BASE = "https://biashara-connect-backend.onrender.com";

        // ===== Login =====
        const loginForm = document.getElementById("loginForm");

        if (!loginForm) {
            console.error("loginForm not found!");
            return;
        }

        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Remove old errors
            let errorDiv = loginForm.querySelector(".error-msg");
            if (errorDiv) errorDiv.remove();

            const email = loginForm.querySelector("input[name='email']").value.trim();
            const password = loginForm.querySelector("input[name='password']").value;

            if (!email || !password) {
                showLoginError("Email and password are required.");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/api/auth/login/`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ email, password }),
                });

                const text = await res.text();
                console.log("Login raw response:", text);

                let data;
                try { data = JSON.parse(text); }
                catch { data = { error: text }; }

                if (!res.ok) {
                    showLoginError(data.error || "Invalid login credentials.");
                    return;
                }

                // ✅ Save tokens
                if (data.access) localStorage.setItem("access_token", data.access);
                if (data.refresh) localStorage.setItem("refresh_token", data.refresh);
                if (data.user_type) localStorage.setItem("user_type", data.user_type);

                // ✅ Close modal
                bootstrap.Modal.getInstance(
                    document.getElementById("loginModal")
                ).hide();

                // ✅ Redirect based on role
                if (data.user_type === "seller") {
                    window.location.href = "/seller/dashboard.html";
                } else {
                    window.location.href = "/buyer/dashboard.html";
                }

            } catch (err) {
                console.error(err);
                showLoginError("Network error. Please try again.");
            }
        });

        function showLoginError(message) {
            const div = document.createElement("div");
            div.className = "error-msg text-danger mb-3";
            div.innerText = message;
            loginForm.prepend(div);
        }
    });
</script>