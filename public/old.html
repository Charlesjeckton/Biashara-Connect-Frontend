<section id="header" class="header section">
    <header class="main-header">
        <div class="container py-3">

            <div class="row align-items-center justify-content-between g-3">

                <div class="col-lg-3 col-md-4 col-10 col-sm-8 logo-section d-flex align-items-center">
                    <button class="mobile-menu-btn me-2 me-sm-3 d-lg-none" aria-label="Toggle Navigation">
                        <i class="fas fa-bars"></i>
                    </button>

                    <a href="/index.html" class="logo d-flex align-items-center text-nowrap">
                        <i class="fas fa-handshake logo-icon"></i>
                        <div class="logo-text-wrapper">
                            <div class="logo-text">BiasharaConnect</div>
                            <div class="logo-tagline d-none d-sm-block">Kenya's Marketplace</div>
                        </div>
                    </a>
                </div>

                <div class="col-lg-5 col-md-8 col-12 search-container d-flex justify-content-center">
                    <div class="search-box d-flex w-100">
                        <input type="text" class="search-input" placeholder="Search products, services, or sellers...">
                        <button class="search-btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>

            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <nav aria-label="Main Navigation">
                        <ul class="nav-menu d-flex justify-content-center" id="mainMenu">

                            <li class="nav-item">
                                <a href="/index.html" class="nav-link">
                                    <i class="fas fa-store me-2"></i> Marketplace
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/sell.html" class="nav-link">
                                    <i class="fas fa-hand-holding-dollar me-2"></i> Sell & Earn
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/favorites.html" class="nav-link">
                                    <i class="fas fa-bookmark me-2"></i> Favorites
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/my-listings.html" class="nav-link">
                                    <i class="fas fa-list-alt me-2"></i> My Listings
                                </a>
                            </li>

                            <li class="nav-item">
                                <a href="/support.html" class="nav-link active">
                                    <i class="fas fa-envelope me-2"></i> Contact Us
                                </a>
                            </li>

                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-circle me-2"></i> My Account
                                </a>

                                <div class="dropdown-menu">
                                    <!-- Profile Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#SellerModal">
                                        <i class="fas fa-user me-2"></i> Seller Profile
                                    </a>

                                    <!-- Profile Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#BuyerModal">
                                        <i class="fas fa-user me-2"></i> Buyer Profile
                                    </a>

                                    <a class="dropdown-item d-flex justify-content-between align-items-center"
                                        href="/messages.html">
                                        <span><i class="fas fa-envelope me-2"></i> Messages</span>
                                        <span class="badge bg-danger">5</span>
                                    </a>

                                    <div class="dropdown-divider"></div>

                                    <!-- Register Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#registerModal">
                                        <i class="fas fa-user-plus me-2"></i> Register
                                    </a>

                                    <!-- Login Modal Trigger -->
                                    <a class="dropdown-item" href="#" data-bs-toggle="modal"
                                        data-bs-target="#loginModal">
                                        <i class="fas fa-sign-in-alt me-2"></i> Login
                                    </a>

                                    <a class="dropdown-item" href="#">
                                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                                    </a>
                                </div>
                            </li>

                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div id="modals-placeholder"></div>

</section>










<!-- My Listings Hero Section -->
        <section id="my-listings-hero" class="my-listings-hero py-4">
            <div class="container my-listings-hero-content">
                <h1><i class="fas fa-list-alt me-2"></i>My Listings</h1>
                <p>Manage your products and services, track performance, and connect with buyers</p>

                <div class="my-listings-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalListings">0</span>
                        <span class="stat-label">Total Listings</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="activeListings">0</span>
                        <span class="stat-label">Active</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="soldListings">0</span>
                        <span class="stat-label">Sold</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="totalViews">0</span>
                        <span class="stat-label">Total Views</span>
                    </div>
                </div>
            </div>
        </section>












        <script>
    document.addEventListener("DOMContentLoaded", () => {
        const API_BASE = "https://biashara-connect-backend.onrender.com";

        // Helper function for displaying errors
        function showError(form, message) {
            let errorDiv = form.querySelector(".error-msg");
            if (!errorDiv) {
                errorDiv = document.createElement("div");
                errorDiv.className = "error-msg text-danger mb-3";
                form.prepend(errorDiv);
            }
            errorDiv.innerText = message;
            errorDiv.style.display = "block";
        }

        // ===== Buyer Registration =====
        const buyerForm = document.getElementById("buyerForm");
        if (buyerForm) {
            buyerForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                showError(buyerForm, "");

                const formData = {
                    first_name: buyerForm.querySelector("input[name='first_name']").value,
                    last_name: buyerForm.querySelector("input[name='last_name']").value,
                    email: buyerForm.querySelector("input[name='email']").value,
                    phone: buyerForm.querySelector("input[name='phone']").value,
                    password: buyerForm.querySelector("input[name='password']").value,
                    location: buyerForm.querySelector("select[name='location']").value,
                };

                try {
                    const res = await fetch(`${API_BASE}/api/auth/register/buyer/`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData),
                    });

                    const text = await res.text();
                    console.log("Buyer raw response:", text);

                    let data;
                    try { data = JSON.parse(text); } catch { data = { error: text }; }

                    if (res.ok) {
                        alert(data.message || "Buyer registered successfully!");
                        buyerForm.reset();
                    } else {
                        showError(buyerForm, data.error || JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    showError(buyerForm, "Network error. See console for details.");
                }
            });
        } else {
            console.error("buyerForm not found in DOM!");
        }

        // ===== Seller Registration =====
        const sellerForm = document.getElementById("sellerForm");
        if (sellerForm) {
            sellerForm.addEventListener("submit", async (e) => {
                e.preventDefault();
                showError(sellerForm, "");

                const formData = new FormData();
                const fields = ["first_name", "last_name", "email", "phone", "password"];
                fields.forEach(f => {
                    const input = sellerForm.querySelector(`[name='${f}']`);
                    if (input) formData.append(f, input.value);
                });

                const locationSelect = sellerForm.querySelector("select[name='location']");
                if (locationSelect) formData.append("location", locationSelect.value);

                // Profile picture
                const profileInput = document.getElementById("sellerProfile");
                if (profileInput && profileInput.files.length > 0) {
                    formData.append("profile_picture", profileInput.files[0]);
                }

                try {
                    const res = await fetch(`${API_BASE}/api/auth/register/seller/`, {
                        method: "POST",
                        body: formData,
                    });

                    const text = await res.text();
                    console.log("Seller raw response:", text);

                    let data;
                    try { data = JSON.parse(text); } catch { data = { error: text }; }

                    if (res.ok) {
                        alert(data.message || "Seller registered successfully!");
                        sellerForm.reset();
                        if (profileInput) profileInput.value = "";
                    } else {
                        showError(sellerForm, data.error || JSON.stringify(data));
                    }
                } catch (err) {
                    console.error(err);
                    showError(sellerForm, "Network error. See console for details.");
                }
            });
        } else {
            console.error("sellerForm not found in DOM!");
        }
    });
</script>




<!-- JavaScript for Profile Picture Upload -->
<script>
    function previewSellerProfile(event) {
        const input = event.target;
        const preview = document.getElementById('sellerProfilePreview');

        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Validate file size (max 2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('File size should be less than 2MB');
                clearSellerProfile();
                return;
            }

            // Validate file type
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                alert('Please upload a valid image file (JPG, PNG, GIF, or WEBP)');
                clearSellerProfile();
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.classList.add('border-success');
                preview.classList.remove('border-success-subtle');
            }
            reader.readAsDataURL(file);
        }
    }

    function clearSellerProfile() {
        const input = document.getElementById('sellerProfile');
        const preview = document.getElementById('sellerProfilePreview');

        input.value = '';
        preview.src = 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
        preview.classList.remove('border-success');
        preview.classList.add('border-success-subtle');
    }

    // Add click event to preview image to trigger file input
    document.addEventListener('DOMContentLoaded', function () {
        const preview = document.getElementById('sellerProfilePreview');
        if (preview) {
            preview.addEventListener('click', function () {
                document.getElementById('sellerProfile').click();
            });
        }

        // Form submission handler
        const sellerForm = document.getElementById('sellerForm');
        if (sellerForm) {
            sellerForm.addEventListener('submit', function (e) {
                e.preventDefault();

                // Here you would handle the form submission
                // The profile picture is optional, so no validation needed
                const formData = new FormData(this);
                const profileInput = document.getElementById('sellerProfile');

                if (profileInput.files.length > 0) {
                    formData.append('profile_picture', profileInput.files[0]);
                }

                // Add your AJAX submission logic here
                console.log('Seller form submitted with profile picture:', profileInput.files.length > 0);

                // For demonstration, just show an alert
                alert('Seller registration submitted successfully!');
            });
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const API_BASE = "https://biashara-connect-backend.onrender.com";

        // ===== Login =====
        const loginForm = document.getElementById("loginForm");

        if (!loginForm) {
            console.error("loginForm not found!");
            return;
        }

        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Remove old errors
            let errorDiv = loginForm.querySelector(".error-msg");
            if (errorDiv) errorDiv.remove();

            const email = loginForm.querySelector("input[name='email']").value.trim();
            const password = loginForm.querySelector("input[name='password']").value;

            if (!email || !password) {
                showLoginError("Email and password are required.");
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/api/auth/login/`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ email, password }),
                });

                const text = await res.text();
                console.log("Login raw response:", text);

                let data;
                try { data = JSON.parse(text); }
                catch { data = { error: text }; }

                if (!res.ok) {
                    showLoginError(data.error || "Invalid login credentials.");
                    return;
                }

                // ✅ Save tokens
                if (data.access) localStorage.setItem("access_token", data.access);
                if (data.refresh) localStorage.setItem("refresh_token", data.refresh);
                if (data.user_type) localStorage.setItem("user_type", data.user_type);

                // ✅ Close modal
                bootstrap.Modal.getInstance(
                    document.getElementById("loginModal")
                ).hide();

                // ✅ Redirect based on role
                if (data.user_type === "seller") {
                    window.location.href = "/seller/dashboard.html";
                } else {
                    window.location.href = "/buyer/dashboard.html";
                }

            } catch (err) {
                console.error(err);
                showLoginError("Network error. Please try again.");
            }
        });

        function showLoginError(message) {
            const div = document.createElement("div");
            div.className = "error-msg text-danger mb-3";
            div.innerText = message;
            loginForm.prepend(div);
        }
    });
</script>