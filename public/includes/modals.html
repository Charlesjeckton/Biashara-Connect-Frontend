<!-- CSS for Auth Modals -->
<style>
    .auth-modal .modal-content {
        border-radius: 15px;
        overflow: hidden;
        border: none;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    .auth-modal .modal-header {
        background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
        color: white;
        border: none;
        padding: 25px 30px;
    }

    .auth-modal .modal-title {
        font-weight: 700;
        font-size: 24px;
    }

    .auth-modal .modal-body {
        padding: 30px;
    }

    .auth-modal .btn-close {
        filter: invert(1) brightness(2);
    }

    .auth-tabs {
        display: flex;
        border-bottom: 2px solid var(--border-color);
        margin-bottom: 25px;
    }

    .auth-tab {
        flex: 1;
        padding: 12px;
        text-align: center;
        background: none;
        border: none;
        color: var(--text-light);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
    }

    .auth-tab.active {
        color: var(--primary-green);
        border-bottom-color: var(--primary-green);
    }

    .form-floating {
        margin-bottom: 20px;
    }

    .form-floating label {
        color: var(--text-light);
    }

    .form-control:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 0.25rem rgba(26, 127, 95, 0.25);
    }

    .password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-light);
        cursor: pointer;
        z-index: 5;
    }

    .form-check-label {
        font-size: 14px;
        color: var(--text-light);
    }

    .form-check-input:checked {
        background-color: var(--primary-green);
        border-color: var(--primary-green);
    }

    .social-login {
        text-align: center;
        margin: 25px 0;
        position: relative;
    }

    .social-login::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        background: var(--border-color);
        z-index: 1;
    }

    .social-login span {
        background: white;
        position: relative;
        z-index: 2;
        padding: 0 15px;
        color: var(--text-light);
        font-size: 14px;
    }

    .social-buttons {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
    }

    .social-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        background: white;
        color: var(--text-dark);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .social-btn:hover {
        border-color: var(--primary-green);
        transform: translateY(-2px);
    }

    .social-btn.google i {
        color: #DB4437;
    }

    .social-btn.facebook i {
        color: #4267B2;
    }

    .auth-link {
        text-align: center;
        margin-top: 20px;
        color: var(--text-light);
        font-size: 14px;
    }

    .auth-link a {
        color: var(--primary-green);
        text-decoration: none;
        font-weight: 600;
    }

    .auth-link a:hover {
        text-decoration: underline;
    }

    .terms-check label {
        font-size: 13px;
        line-height: 1.4;
    }

    .terms-check a {
        color: var(--primary-green);
        text-decoration: none;
    }

    .terms-check a:hover {
        text-decoration: underline;
    }

    .btn-auth {
        background: var(--primary-green);
        color: white;
        border: none;
        padding: 14px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s;
        width: 100%;
    }

    .btn-auth:hover {
        background: var(--dark-green);
        transform: translateY(-2px);
    }

    .input-group {
        position: relative;
    }

    .phone-prefix {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-light);
        z-index: 10;
        pointer-events: none;
    }

    .phone-input {
        padding-left: 50px !important;
    }

    .password-strength {
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        margin-top: 5px;
        overflow: hidden;
    }

    .strength-meter {
        height: 100%;
        width: 0;
        transition: width 0.3s, background 0.3s;
    }

    .strength-meter.weak {
        width: 25%;
        background: #dc3545;
    }

    .strength-meter.fair {
        width: 50%;
        background: #ffc107;
    }

    .strength-meter.good {
        width: 75%;
        background: #28a745;
    }

    .strength-meter.strong {
        width: 100%;
        background: var(--primary-green);
    }

    .password-hint {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 5px;
        display: none;
    }

    .password-hint.show {
        display: block;
    }

    .otp-inputs {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin: 20px 0;
    }

    .otp-input {
        width: 50px;
        height: 50px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        border: 2px solid var(--border-color);
        border-radius: 8px;
    }

    .otp-input:focus {
        border-color: var(--primary-green);
        outline: none;
    }

    .resend-otp {
        text-align: center;
        margin-top: 15px;
        font-size: 14px;
    }

    .resend-otp a {
        color: var(--primary-green);
        text-decoration: none;
        font-weight: 600;
    }

    .resend-otp a:hover {
        text-decoration: underline;
    }
</style>

<!-- Login Modal -->
<div class="modal fade auth-modal" id="loginModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Welcome Back</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Tabs for Login Method -->
                <div class="auth-tabs">
                    <button class="auth-tab active" data-method="email">Email</button>
                    <button class="auth-tab" data-method="phone">Phone</button>
                </div>

                <!-- Email Login Form -->
                <form id="emailLoginForm" class="auth-form">
                    <div class="form-floating">
                        <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" required>
                        <label for="loginEmail">Email Address</label>
                    </div>

                    <div class="form-floating">
                        <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                        <label for="loginPassword">Password</label>
                        <button type="button" class="password-toggle" data-target="loginPassword">
                            <i class="far fa-eye"></i>
                        </button>
                        <div class="text-end mt-2">
                            <a href="#" class="text-decoration-none" style="font-size: 14px; color: var(--primary-green);">
                                Forgot Password?
                            </a>
                        </div>
                    </div>

                    <div class="form-check mb-4">
                        <input class="form-check-input" type="checkbox" id="rememberMe">
                        <label class="form-check-label" for="rememberMe">
                            Remember me on this device
                        </label>
                    </div>

                    <button type="submit" class="btn-auth">
                        <i class="fas fa-sign-in-alt me-2"></i> Login
                    </button>
                </form>

                <!-- Phone Login Form (Hidden by default) -->
                <form id="phoneLoginForm" class="auth-form" style="display: none;">
                    <div class="form-floating">
                        <div class="input-group">
                            <span class="phone-prefix">+254</span>
                            <input type="tel" class="form-control phone-input" id="loginPhone" placeholder="7XX XXX XXX" required>
                            <label for="loginPhone" style="left: 50px;">Phone Number</label>
                        </div>
                    </div>

                    <div class="form-floating">
                        <input type="password" class="form-control" id="phonePassword" placeholder="Password" required>
                        <label for="phonePassword">Password</label>
                        <button type="button" class="password-toggle" data-target="phonePassword">
                            <i class="far fa-eye"></i>
                        </button>
                    </div>

                    <button type="submit" class="btn-auth">
                        <i class="fas fa-sign-in-alt me-2"></i> Login with Phone
                    </button>
                </form>

                <!-- Social Login -->
                <div class="social-login">
                    <span>Or continue with</span>
                </div>

                <div class="social-buttons">
                    <button class="social-btn google">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>

                <div class="auth-link">
                    Don't have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Sign up</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade auth-modal" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">Join Biashara Connect</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <!-- Step 1: Basic Info -->
                    <div class="register-step" id="step1">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="firstName" placeholder="John" required>
                                    <label for="firstName">First Name</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="lastName" placeholder="Doe" required>
                                    <label for="lastName">Last Name</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="registerEmail" placeholder="name@example.com" required>
                            <label for="registerEmail">Email Address</label>
                        </div>

                        <div class="form-floating mb-3">
                            <div class="input-group">
                                <span class="phone-prefix">+254</span>
                                <input type="tel" class="form-control phone-input" id="registerPhone" placeholder="7XX XXX XXX" required>
                                <label for="registerPhone" style="left: 50px;">Phone Number</label>
                            </div>
                        </div>

                        <div class="form-floating mb-3">
                            <select class="form-select" id="userType" required>
                                <option value="" selected disabled>Select account type</option>
                                <option value="buyer">Buyer</option>
                                <option value="seller">Seller</option>
                                <option value="both">Both Buyer & Seller</option>
                            </select>
                            <label for="userType">I want to</label>
                        </div>

                        <button type="button" class="btn-auth next-step" data-next="step2">
                            Continue <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>

                    <!-- Step 2: Password & Terms -->
                    <div class="register-step" id="step2" style="display: none;">
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="registerPassword" placeholder="Password" required>
                            <label for="registerPassword">Create Password</label>
                            <button type="button" class="password-toggle" data-target="registerPassword">
                                <i class="far fa-eye"></i>
                            </button>
                            <div class="password-strength">
                                <div class="strength-meter" id="passwordStrength"></div>
                            </div>
                            <div class="password-hint" id="passwordHint">
                                Password must be at least 8 characters with letters and numbers
                            </div>
                        </div>

                        <div class="form-floating mb-4">
                            <input type="password" class="form-control" id="confirmPassword" placeholder="Confirm Password" required>
                            <label for="confirmPassword">Confirm Password</label>
                            <button type="button" class="password-toggle" data-target="confirmPassword">
                                <i class="far fa-eye"></i>
                            </button>
                        </div>

                        <div class="terms-check mb-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="termsAgreement" required>
                                <label class="form-check-label" for="termsAgreement">
                                    I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a>
                                    and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="marketingConsent">
                                <label class="form-check-label" for="marketingConsent">
                                    I'd like to receive marketing updates and special offers
                                </label>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary prev-step" data-prev="step1">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </button>
                            <button type="button" class="btn-auth next-step" data-next="step3">
                                Continue <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Location & Verification -->
                    <div class="register-step" id="step3" style="display: none;">
                        <div class="form-floating mb-3">
                            <select class="form-select" id="location" required>
                                <option value="" selected disabled>Select your location</option>
                                <option>Nairobi</option>
                                <option>Mombasa</option>
                                <option>Kisumu</option>
                                <option>Nakuru</option>
                                <option>Eldoret</option>
                                <option>Thika</option>
                                <option>Other</option>
                            </select>
                            <label for="location">Primary Location</label>
                        </div>

                        <div class="form-floating mb-4">
                            <textarea class="form-control" id="userBio" placeholder="Tell us about yourself" style="height: 100px"></textarea>
                            <label for="userBio">Bio (Optional)</label>
                            <div class="form-text">Briefly describe yourself or your business</div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label mb-3">How did you hear about us?</label>
                            <div class="row">
                                <div class="col-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="referral" id="referralFriend" value="friend">
                                        <label class="form-check-label" for="referralFriend">Friend</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="referral" id="referralSocial" value="social">
                                        <label class="form-check-label" for="referralSocial">Social Media</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="referral" id="referralSearch" value="search">
                                        <label class="form-check-label" for="referralSearch">Search Engine</label>
                                    </div>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="referral" id="referralOther" value="other">
                                        <label class="form-check-label" for="referralOther">Other</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary prev-step" data-prev="step2">
                                <i class="fas fa-arrow-left me-2"></i> Back
                            </button>
                            <button type="submit" class="btn-auth">
                                <i class="fas fa-user-plus me-2"></i> Create Account
                            </button>
                        </div>
                    </div>
                </form>

                <div class="auth-link mt-4">
                    Already have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Auth Modals -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password toggle functionality
    document.querySelectorAll('.password-toggle').forEach(button => {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const input = document.getElementById(targetId);
            const icon = this.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });
    });

    // Login method tabs
    document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const method = this.getAttribute('data-method');

            // Update active tab
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');

            // Show corresponding form
            document.getElementById('emailLoginForm').style.display = method === 'email' ? 'block' : 'none';
            document.getElementById('phoneLoginForm').style.display = method === 'phone' ? 'block' : 'none';
        });
    });

    // Registration multi-step
    document.querySelectorAll('.next-step').forEach(button => {
        button.addEventListener('click', function() {
            const nextStep = this.getAttribute('data-next');
            const currentStep = this.closest('.register-step').id;

            // Validate current step before proceeding
            if (validateStep(currentStep)) {
                document.getElementById(currentStep).style.display = 'none';
                document.getElementById(nextStep).style.display = 'block';
            }
        });
    });

    document.querySelectorAll('.prev-step').forEach(button => {
        button.addEventListener('click', function() {
            const prevStep = this.getAttribute('data-prev');
            const currentStep = this.closest('.register-step').id;

            document.getElementById(currentStep).style.display = 'none';
            document.getElementById(prevStep).style.display = 'block';
        });
    });

    // Password strength checker
    const passwordInput = document.getElementById('registerPassword');
    const strengthMeter = document.getElementById('passwordStrength');
    const passwordHint = document.getElementById('passwordHint');

    if (passwordInput) {
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            let strength = 0;

            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;

            strengthMeter.className = 'strength-meter';
            passwordHint.classList.remove('show');

            if (password.length > 0) {
                passwordHint.classList.add('show');

                if (strength < 2) {
                    strengthMeter.classList.add('weak');
                } else if (strength === 2) {
                    strengthMeter.classList.add('fair');
                } else if (strength === 3) {
                    strengthMeter.classList.add('good');
                } else {
                    strengthMeter.classList.add('strong');
                }
            }
        });
    }

    // Form validation
    function validateStep(stepId) {
        const step = document.getElementById(stepId);
        const inputs = step.querySelectorAll('input[required], select[required]');

        for (let input of inputs) {
            if (!input.value.trim()) {
                input.classList.add('is-invalid');
                return false;
            } else {
                input.classList.remove('is-invalid');
            }
        }

        // Special validation for step 2
        if (stepId === 'step2') {
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const terms = document.getElementById('termsAgreement');

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return false;
            }

            if (!terms.checked) {
                alert('You must agree to the Terms of Service');
                return false;
            }
        }

        return true;
    }

    // Form submission
    document.getElementById('registerForm')?.addEventListener('submit', function(e) {
        e.preventDefault();

        // Simulate registration
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;

        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Creating Account...';
        submitBtn.disabled = true;

        setTimeout(() => {
            alert('Account created successfully! Please check your email for verification.');
            submitBtn.innerHTML = originalText;
            submitBtn.disabled = false;
            document.getElementById('registerModal').querySelector('.btn-close').click();
        }, 2000);
    });

    document.getElementById('emailLoginForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        // Add login logic here
        alert('Login successful!');
    });

    document.getElementById('phoneLoginForm')?.addEventListener('submit', function(e) {
        e.preventDefault();
        // Add phone login logic here
        alert('Login successful!');
    });
});
</script>